number=sprintf("%04d",number))
phyto_number$number
head
colnames(resultPhyto)=paste(head,phyto_number$number,sep='#')
View(resultPhyto)
resultPhyto=data.table::fread(file =paste0('../../bin/msvc14/x64/phytomers.csv'),header=F,skip = 3)
head=colnames(data.table::fread(file =paste0('../../bin/msvc14/x64/phytomers.csv'),header=T))
head
phyto_number=data.frame(path=colnames(data.table::fread(file =paste0('../../bin/msvc14/x64/phytomers.csv'),header=T,skip=1)))%>%
mutate(n=row_number())%>%
group_by(n)%>%
mutate(number=str_extract(string = path,pattern =  "(?<=\\[).+?(?=\\])")[[1]],
number=sprintf("%04d",number))
phyto_number
phyto_number=data.frame(path=colnames(data.table::fread(file =paste0('../../bin/msvc14/x64/phytomers.csv'),header=T,skip=1)))%>%
mutate(n=row_number())%>%
group_by(n)%>%
mutate(number=str_extract(string = path,pattern =  "(?<=\\[).+?(?=\\])")[[1]])
phyto_number
phyto_number=data.frame(path=colnames(data.table::fread(file =paste0('../../bin/msvc14/x64/phytomers.csv'),header=T,skip=1)))%>%
mutate(n=row_number())%>%
group_by(n)%>%
mutate(number=str_extract(string = path,pattern =  "(?<=\\[).+?(?=\\])")[[1]],
number=sprintf("%04d",as.numeric(number)))
phyto_number
phyto_number=data.frame(path=colnames(data.table::fread(file =paste0('../../bin/msvc14/x64/phytomers.csv'),header=T,skip=1)))%>%
mutate(n=row_number())%>%
group_by(n)%>%
mutate(number=str_extract(string = path,pattern =  "(?<=\\[).+?(?=\\])")[[1]],
number=as.numeric(sprintf("%04d",as.numeric(number))))
phyto_number
phyto_number=data.frame(path=colnames(data.table::fread(file =paste0('../../bin/msvc14/x64/phytomers.csv'),header=T,skip=1)))%>%
mutate(n=row_number())%>%
group_by(n)%>%
mutate(number=str_extract(string = path,pattern =  "(?<=\\[).+?(?=\\])")[[1]],
number=sprintf("%04d",as.numeric(number)))
colnames(resultPhyto)=paste(head,phyto_number$number,sep='#')
View(resultPhyto)
inputPhyto=data.frame(key=colnames(phyto))%>%
separate(key,into = c('var','number'),sep = '#')%>%
filter(var!='time')
inputPhyto
inputPhyto=data.frame(key=colnames(phyto))%>%
separate(key,into = c('var','number'),sep = '#')%>%
filter(var!='time')%>%
mutate(number=sprintf("%04d",as.numeric(number)))
inputPhyto
sort(as.numeric(unique(inputPhyto$number)))
sort(unique(inputPhyto$number))
runApp('App_Xpalm.R')
unique(inputPhyto$number)
sub_phyto=phyto%>%
rename(time=`time#NA`)%>%
mutate(Date=ymd(str_sub(time,start = 0,end = 10)))%>%
select(Date,contains(variablePhyto_x))%>%
select(Date,contains(paste0("#",phytomerNumber)))%>%
tidyr::gather('number',"value",-c(Date))%>%
mutate(number=str_remove(string = number,pattern = paste0(variablePhyto_x,'#')))%>%
filter(number %in% phytomerNumber)%>%
arrange(Date,number)
sub_phyto
phytomerNumber
phytomerNumber=0010
sub_phyto=phyto%>%
rename(time=`time#NA`)%>%
mutate(Date=ymd(str_sub(time,start = 0,end = 10)))%>%
select(Date,contains(variablePhyto_x))%>%
select(Date,contains(paste0("#",phytomerNumber)))%>%
tidyr::gather('number',"value",-c(Date))%>%
mutate(number=str_remove(string = number,pattern = paste0(variablePhyto_x,'#')))%>%
filter(number %in% phytomerNumber)%>%
arrange(Date,number)
sub_phyto
View(phyto)
phyto=resultPhyto
View(phyto)
phytomerNumber
phytomerNumber='0010'
phyto%>%
rename(time=`time#NA`)%>%
mutate(Date=ymd(str_sub(time,start = 0,end = 10)))%>%
select(Date,contains(variablePhyto_x))%>%
select(Date,contains(paste0("#",phytomerNumber)))
View(phyto)
phyto%>%
rename(time=`time#NA`)
phyto%>%
rename(time=`time# NA`)
phyto%>%
rename(time=`time#  NA`)
sub_phyto=phyto%>%
rename(time=`time#  NA`)%>%
mutate(Date=ymd(str_sub(time,start = 0,end = 10)))%>%
select(Date,contains(variablePhyto_x))%>%
select(Date,contains(paste0("#",phytomerNumber)))%>%
tidyr::gather('number',"value",-c(Date))%>%
mutate(number=str_remove(string = number,pattern = paste0(variablePhyto_x,'#')))%>%
filter(number %in% phytomerNumber)%>%
arrange(Date,number)
View(sub_phyto)
runApp('App_Xpalm.R')
result=data.table::fread(file =paste0('../../bin/msvc14/x64/plant.csv'),header=T,skip = 3)
head=colnames(data.table::fread(file =paste0('../../bin/msvc14/x64/plant.csv'),header=T))
colnames(result)=head
result=result%>%
mutate(Date=ymd(str_sub(time,start = 0,end = 10)))%>%
select(-time)
result%>%
mutate(month=paste0(month(Date),'/',year(Date)),
FFB=BUNCH_NONOIL_BIOMASS_HARVESTED+BUNCH_OIL_BIOMASS_HARVESTED)%>%
group_by(month)%>%
summarize(nb_days=n(),
age=TREE_AGE/365,
yield_FFB=sum(FFB)/1000,
yield_oil=sum(BUNCH_OIL_BIOMASS_HARVESTED)/1000)%>%
filter(nb_days>27)%>%
ungroup()%>%
ggplot()+
geom_point(aes(x=my(month),y=yield_FFB,col='FFB',label=paste('age:',round(age,2))))+
geom_line(aes(x=my(month),y=yield_FFB,col='FFB'))+
geom_point(aes(x=my(month),y=yield_oil,col='Oil',label=paste('age:',round(age,2))))+
geom_line(aes(x=my(month),y=yield_oil,col='Oil'))+
labs(x='',
y='kg.tree-1')+
scale_color_discrete(name='')
result%>%
mutate(month=paste0(month(Date),'/',year(Date)),
FFB=BUNCH_NONOIL_BIOMASS_HARVESTED+BUNCH_OIL_BIOMASS_HARVESTED)%>%
group_by(month)%>%
summarize(nb_days=n(),
age=TREE_AGE/365,
yield_FFB=sum(FFB)/1000,
yield_oil=sum(BUNCH_OIL_BIOMASS_HARVESTED)/1000)%>%
filter(nb_days>27)%>%
ungroup()%>%
ggplot()+
geom_point(aes(x=my(month),y=yield_FFB,col='FFB Xplam',label=paste('age:',round(age,2))))+
geom_line(aes(x=my(month),y=yield_FFB,col='FFB Xpalm'))+
# geom_point(aes(x=my(month),y=yield_oil,col='Oil',label=paste('age:',round(age,2))))+
# geom_line(aes(x=my(month),y=yield_oil,col='Oil'))+
labs(x='',
y='kg.tree-1')+
scale_color_discrete(name='')
result%>%
mutate(month=paste0(month(Date),'/',year(Date)),
FFB=BUNCH_NONOIL_BIOMASS_HARVESTED+BUNCH_OIL_BIOMASS_HARVESTED)%>%
group_by(month)%>%
summarize(nb_days=n(),
age=TREE_AGE/365,
yield_FFB=sum(FFB)/1000,
yield_oil=sum(BUNCH_OIL_BIOMASS_HARVESTED)/1000)%>%
filter(nb_days>27)%>%
ungroup()%>%
ggplot()+
geom_point(aes(x=my(month),y=yield_FFB,col='FFB Xpalm',label=paste('age:',round(age,2))))+
geom_line(aes(x=my(month),y=yield_FFB,col='FFB Xpalm'))+
# geom_point(aes(x=my(month),y=yield_oil,col='Oil',label=paste('age:',round(age,2))))+
# geom_line(aes(x=my(month),y=yield_oil,col='Oil'))+
labs(x='',
y='kg.tree-1')+
scale_color_discrete(name='')
# load CIGE data ----------------------------------------------------------
obs=data.table::fread(file = './Data/Full_Data_Plot_Growth_Bunch_SMSE_B22.txt')
View(obs)
params = data.table::fread('D:/PAMStudio/dev/git/XPalm/parameters/XPalm_parameters_ref.txt',header=F)%>%
select(V1,V3)%>%
mutate(V3=as.numeric(V3))%>%
data.frame()
colnames(params)=c('Parameter','value')
params
meteo = data.table::fread('D:/PAMStudio/dev/git/XPalm/parameters/meteo_all_SMSE.txt.txt')
meteo = data.table::fread('D:/PAMStudio/dev/git/XPalm/parameters/meteo_all_SMSE.txt')
####generate meteo file fo Xpalm####
# Load packages -----------------------------------------------------------
packs <- c("lubridate", "stringr", "ggplot2",'dplyr','viridis','tidyr','data.table','plotly')
InstIfNec<-function (pack) {
if (!do.call(require,as.list(pack))) {
do.call(install.packages,as.list(pack))  }
do.call(require,as.list(pack)) }
lapply(packs, InstIfNec)
# # import raw meteo----------------------------------------------------------
#
# met_TOWE=data.table::fread(input = '../R/Data/Meteo_extract_BDD_TOWE.txt')%>%
#   mutate(date=ymd(ObservationDate))
# met_SMSE=data.table::fread(input = '../R/Data/Meteo_extract_BDD_SMSE.txt')%>%
#   mutate(date=ymd(ObservationDate))
# met_PRESCO=data.table::fread(input = '../R/Data/Meteo_extract_BDD_PR.txt')%>%
#   mutate(date=ymd(ObservationDate))
#
#
# period_TOWE=range(met_TOWE$date)
# period_SMSE=range(met_SMSE$date)
# period_PR=range(met_PRESCO$date)
#
# # extract variables -------------------------------------------------------
#
#
# met_TOWE=met_TOWE%>%
#   mutate(day=as.numeric(str_sub(string = ObservationDate,start = 9,end = 10)),
#          month=as.numeric(str_sub(string = ObservationDate,start = 6,end = 7)),
#          year=as.numeric(str_sub(string = ObservationDate,start = 0,end = 4)))%>%
#   select(day,month,year,TMax,TMin,HRMax,HRMin,WindSpeed,Rg,Rainfall)
# summary(met_TOWE)
#
# met_TOWE=met_TOWE%>%
#   mutate(Rainfall=ifelse(is.na(Rainfall),0,Rainfall))
#
# met_SMSE=met_SMSE%>%
#   mutate(day=as.numeric(str_sub(string = ObservationDate,start = 9,end = 10)),
#          month=as.numeric(str_sub(string = ObservationDate,start = 6,end = 7)),
#          year=as.numeric(str_sub(string = ObservationDate,start = 0,end = 4)))%>%
#   select(day,month,year,TMax,TMin,HRMax,HRMin,WindSpeed,Rg,Rainfall)
# summary(met_SMSE)
#
# met_PRESCO=met_PRESCO%>%
#   mutate(day=as.numeric(str_sub(string = ObservationDate,start = 9,end = 10)),
#          month=as.numeric(str_sub(string = ObservationDate,start = 6,end = 7)),
#          year=as.numeric(str_sub(string = ObservationDate,start = 0,end = 4)))%>%
#   select(day,month,year,TMax,TMin,HRMax,HRMin,WindSpeed,Rg,Rainfall)
# summary(met_PRESCO)
#
#
#
# # subsetting common dates between sites -----------------------------------
# ###define dates of simul
#
# date_ini=max(c(period_TOWE[1],period_SMSE[1],period_PR[1]))
# date_fin=min(c(period_TOWE[2],period_SMSE[2],period_PR[2]))
#
#
# met_PRESCO_sub=met_PRESCO%>%
#   mutate(date=ymd(paste(year,month,day)))%>%
#   filter(date>=date_ini & date<=date_fin)%>%
#   select(-date)
#
# met_SMSE_sub=met_SMSE%>%
#   mutate(date=ymd(paste(year,month,day)))%>%
#   filter(date>=date_ini & date<=date_fin)%>%s
#   select(-date)
#
# met_TOWE_sub=met_TOWE%>%
#   mutate(date=ymd(paste(year,month,day)))%>%
#   filter(date>=date_ini & date<=date_fin)%>%
#   select(-date)
#
# # export ------------------------------------------------------------------
#
# write.table(x = met_SMSE,file = '../parameters/meteo_all_SMSE.txt',row.names = F,quote=F,col.names = F,sep='\t')
# write.table(x = met_SMSE,file = '../parameters/meteo_all_PRESCO.txt',row.names = F,quote=F,col.names = F,sep='\t')
# write.table(x = met_TOWE,file = '../parameters/meteo_all_TOWE.txt',row.names = F,quote=F,col.names = F,sep='\t')
#
# write.table(x = met_SMSE_sub,file = '../parameters/meteo_sub_SMSE.txt',row.names = F,quote=F,col.names = F,sep='\t')
# write.table(x = met_PRESCO_sub,file = '../parameters/meteo_sub_PRESCO.txt',row.names = F,quote=F,col.names = F,sep='\t')
# write.table(x = met_TOWE_sub,file = '../parameters/meteo_sub_TOWE.txt',row.names = F,quote=F,col.names = F,sep='\t')
#' Generate meteo file
#'
#' @param filename name of the raw meteo file
#' @param dir_raw directory of the raw meteo file
#' @param date_ini starting date (dd-mm-yyyy) if NULL takes the first date in the raw file)
#' @param date_end ending date (dd-mm-yyyy)if NULL takes the last date in the raw file
#'
#' @return meteofile
#' @export meteofile
#'
#' @examples
#' filename='meteo_SMSE'
#' dir_raw = '../parameters/'
generate_meteo=function(dir_raw,filename,date_ini=NULL,date_end=NULL){
meteofile= read.table(file = paste0(dir_raw,filename,'.txt'),header = F)
colnames(meteofile)=c('day','month','year','TMax','TMin','HRMax','HRMin','WindSpeed','Rg','Rainfall')
meteofile=meteofile%>%
mutate(date=dmy(paste(day,month,year)))
min=min(meteofile$date)
max=max(meteofile$date)
if (!is.null(date_ini)){
date_ini=dmy(date_ini)
if(date_ini<min){
print(paste('error: select date_ini after',min))
return(NULL)
}
}else{date_ini=min}
if (!is.null(date_end)){
date_end=dmy(date_end)
if(date_end>max){
print(paste('error: select date_end before',max))
return(NULL)
}
}else{date_end=max}
meteofile=meteofile%>%
filter(date>=date_ini & date<=date_end)%>%
select(-date)
write.table(x = meteofile,file = '../parameters/meteo.txt',row.names = F,quote=F,col.names = F,sep='\t')
print(paste('meteo file generated from',date_ini,'to',date_end))
}
filename='meteo_SMSE'
dir_raw = '../parameters/'
generate_meteo(dir_raw = dir_raw,filename = filename)
meteo = data.table::fread('D:/PAMStudio/dev/git/XPalm/parameters/meteo.txt')
View(obs)
result
View(result)
monnb <- function(d) { lt <- as.POSIXlt(as.Date(d, origin="1900-01-01"));
lt$year*12 + lt$mon }
# compute a month difference as a difference between two monnb's
mondf <- function(d1, d2) { monnb(d2) - monnb(d1) }
obs
PlantingDate=ymd('2011-01-01')
range(mete$Date)
range(meteo$Date)
meteo = data.table::fread('D:/PAMStudio/dev/git/XPalm/parameters/meteo.txt')
meteo
meteo = data.table::fread('D:/PAMStudio/dev/git/XPalm/parameters/meteo.txt',herader=T)
meteo = data.table::fread('D:/PAMStudio/dev/git/XPalm/parameters/meteo.txt',header=T)
meteo
meteo = data.table::fread('D:/PAMStudio/dev/git/XPalm/parameters/meteo.txt')
colnames(meteo)=c('day','month','year','TMax','TMin','HRMax','HRMin','WindSpeed','Rg','Rainfall')
meteo
meteo=meteo_raw%>%
mutate(Date=ymd(paste(year,month,day,sep='-')))
meteo_raw = data.table::fread('D:/PAMStudio/dev/git/XPalm/parameters/meteo.txt')
colnames(meteo_raw)=c('day','month','year','TMax','TMin','HRMax','HRMin','WindSpeed','Rg','Rainfall')
meteo=meteo_raw%>%
mutate(Date=ymd(paste(year,month,day,sep='-')))
View(meteo)
# Compare Xpalm vs CIGE data ----------------------------------------------
# Load packages -----------------------------------------------------------
packs <- c('data.table','shiny',"lubridate", "stringr", "ggplot2",'dplyr','viridis','plotly','tidyr','DT','scales','shinythemes','cowplot')
InstIfNec<-function (pack) {
if (!do.call(require,as.list(pack))) {
do.call(install.packages,as.list(pack))  }
do.call(require,as.list(pack)) }
lapply(packs, InstIfNec)
# function ----------------------------------------------------------------
monnb <- function(d) { lt <- as.POSIXlt(as.Date(d, origin="1900-01-01"));
lt$year*12 + lt$mon }
# compute a month difference as a difference between two monnb's
mondf <- function(d1, d2) { monnb(d2) - monnb(d1) }
meteo_raw = data.table::fread('D:/PAMStudio/dev/git/XPalm/parameters/meteo.txt')
colnames(meteo_raw)=c('day','month','year','TMax','TMin','HRMax','HRMin','WindSpeed','Rg','Rainfall')
meteo=meteo_raw%>%
mutate(Date=ymd(paste(year,month,day,sep='-')))
range(meteo$Date)
meteo_raw = data.table::fread('D:/PAMStudio/dev/git/XPalm/parameters/meteo.txt')
colnames(meteo_raw)=c('day','month','year','TMax','TMin','HRMax','HRMin','WindSpeed','Rg','Rainfall')
meteo=meteo_raw%>%
mutate(Date=ymd(paste(year,month,day,sep='-')))
range(meteo$Date)
monnb <- function(d) { lt <- as.POSIXlt(as.Date(d, origin="1900-01-01"));
lt$year*12 + lt$mon }
# compute a month difference as a difference between two monnb's
mondf <- function(d1, d2) { monnb(d2) - monnb(d1) }
params = data.table::fread('D:/PAMStudio/dev/git/XPalm/parameters/XPalm_parameters_ref.txt',header=F)%>%
select(V1,V3)%>%
mutate(V3=as.numeric(V3))%>%
data.frame()
colnames(params)=c('Parameter','value')
range(meteo$Date)
result=data.table::fread(file =paste0('../../bin/msvc14/x64/plant.csv'),header=T,skip = 3)
head=colnames(data.table::fread(file =paste0('../../bin/msvc14/x64/plant.csv'),header=T))
colnames(result)=head
result=result%>%
mutate(Date=ymd(str_sub(time,start = 0,end = 10)))%>%
select(-time)
PlantingDate=ymd('2011-01-01')
obs=data.table::fread(file = './Data/Full_Data_Plot_Growth_Bunch_SMSE_B22.txt')
View(obs)
# load CIGE data ----------------------------------------------------------
obs=data.table::fread(file = './Data/Full_Data_Plot_Growth_Bunch_SMSE_B22.txt')%>%
mutate(PlantingDate=ymd('2011-01-01'),
ObservationDate=ymd(ObservationDate),
MAP=mondf(d2 = ObservationDate,d1 = PlantingDate),
TreeId=as.factor(paste(Site,Plot,BlockNumber,IdGenotype,LineNumber,TreeNumber,sep='_')))
obs=data.table::fread(file = './Data/Full_Data_Plot_Growth_Bunch_SMSE_B22.txt')%>%
mutate(PlantingDate=PlantingDate,
ObservationDate=ymd(ObservationDate),
MAP=mondf(d2 = ObservationDate,d1 = PlantingDate))
data.table::fread(file = './Data/Full_Data_Plot_Growth_Bunch_SMSE_B22.txt')
data.table::fread(file = './Data/Full_Data_Plot_Growth_Bunch_SMSE_B22.txt')%>%
mutate(PlantingDate=PlantingDate)
# load CIGE data ----------------------------------------------------------
obs=data.table::fread(file = './Data/Full_Data_Plot_Growth_Bunch_SMSE_B22.txt')%>%
data.frame()%>%
mutate(PlantingDate=PlantingDate,
ObservationDate=ymd(ObservationDate),
MAP=mondf(d2 = ObservationDate,d1 = PlantingDate),
TreeId=as.factor(paste(Site,Plot,BlockNumber,IdGenotype,LineNumber,TreeNumber,sep='_')))
View(obs)
obsAll=obs%>%
mutate(RachisWC=(RachisSampleFreshWeight-RachisSampleDryWeight)/RachisSampleFreshWeight,
RachisDryWeight=RachisFreshWeight*(1-RachisWC),
PetioleWC=(PetioleSampleFreshWeight-PetioleSampleDryWeight)/PetioleSampleFreshWeight,
PetioleDryWeight=PetioleFreshWeight*(1-PetioleWC),
LeafletsFreshWeight=WholeLeafFreshWeight,
LeafletsWC=(LeafletSampleFreshWeight-LeafletSampleDryWeight)/LeafletSampleFreshWeight,
LeafletsDryWeight=LeafletsFreshWeight*(1-LeafletsWC),
LW_ratio_base=AverageLeafletSampleLengthBase/AverageLeafletSampleWidthBase,
LW_ratio_midd=AverageLeafletSampleLengthMidd/AverageLeafletSampleWidthMidd,
LW_ratio_top=AverageLeafletSampleLengthTop/AverageLeafletSampleWidthTop,
AverageleafletAreaBase=AverageLeafletSampleLengthBase*AverageLeafletSampleWidthBase*coefArrea,
AverageleafletAreaMidd=AverageLeafletSampleLengthMidd*AverageLeafletSampleWidthMidd*coefArrea,
AverageleafletAreaTop=AverageLeafletSampleLengthTop*AverageLeafletSampleWidthTop*coefArrea,
AverageSLABase=AverageleafletAreaBase/(LeafletSampleDryWeight/6),
AverageSLAMidd=AverageleafletAreaMidd/(LeafletSampleDryWeight/6),
AverageSLATop=AverageleafletAreaTop/(LeafletSampleDryWeight/6)
)%>%
mutate(LeafArea=NumberOfLeaflets*(AverageleafletAreaBase+AverageleafletAreaMidd+AverageleafletAreaTop)/(3*10000),
LAI=NbLeaves*LeafArea*Density/10000)%>%
dplyr::select(Site,IdGenotype,TreeId,Plot,BlockNumber,LineNumber,TreeNumber,PhytomerNumber,ObservationDate,MAP,
WholeLeafFreshWeight,RachisLength,RachisFreshWeight,RachisWC,RachisDryWeight,PetioleLength,PetioleFreshWeight,PetioleWC,PetioleDryWeight,
NumberOfLeaflets,LeafletsFreshWeight,LeafletsWC,LeafletsDryWeight,AverageLeafletSampleLengthBase,AverageLeafletSampleLengthMidd,AverageLeafletSampleLengthTop,AverageLeafletSampleWidthBase,AverageLeafletSampleWidthMidd,AverageLeafletSampleWidthTop,LW_ratio_base,LW_ratio_midd,LW_ratio_top,AverageleafletAreaBase,AverageleafletAreaMidd,AverageleafletAreaTop,AverageSLABase,AverageSLAMidd,AverageSLATop,LeafArea,LAI)
###compute leaf growth data####
coefArrea=0.7
NbLeaves=32
obsAll=obs%>%
mutate(RachisWC=(RachisSampleFreshWeight-RachisSampleDryWeight)/RachisSampleFreshWeight,
RachisDryWeight=RachisFreshWeight*(1-RachisWC),
PetioleWC=(PetioleSampleFreshWeight-PetioleSampleDryWeight)/PetioleSampleFreshWeight,
PetioleDryWeight=PetioleFreshWeight*(1-PetioleWC),
LeafletsFreshWeight=WholeLeafFreshWeight,
LeafletsWC=(LeafletSampleFreshWeight-LeafletSampleDryWeight)/LeafletSampleFreshWeight,
LeafletsDryWeight=LeafletsFreshWeight*(1-LeafletsWC),
LW_ratio_base=AverageLeafletSampleLengthBase/AverageLeafletSampleWidthBase,
LW_ratio_midd=AverageLeafletSampleLengthMidd/AverageLeafletSampleWidthMidd,
LW_ratio_top=AverageLeafletSampleLengthTop/AverageLeafletSampleWidthTop,
AverageleafletAreaBase=AverageLeafletSampleLengthBase*AverageLeafletSampleWidthBase*coefArrea,
AverageleafletAreaMidd=AverageLeafletSampleLengthMidd*AverageLeafletSampleWidthMidd*coefArrea,
AverageleafletAreaTop=AverageLeafletSampleLengthTop*AverageLeafletSampleWidthTop*coefArrea,
AverageSLABase=AverageleafletAreaBase/(LeafletSampleDryWeight/6),
AverageSLAMidd=AverageleafletAreaMidd/(LeafletSampleDryWeight/6),
AverageSLATop=AverageleafletAreaTop/(LeafletSampleDryWeight/6)
)%>%
mutate(LeafArea=NumberOfLeaflets*(AverageleafletAreaBase+AverageleafletAreaMidd+AverageleafletAreaTop)/(3*10000),
LAI=NbLeaves*LeafArea*Density/10000)%>%
dplyr::select(Site,IdGenotype,TreeId,Plot,BlockNumber,LineNumber,TreeNumber,PhytomerNumber,ObservationDate,MAP,
WholeLeafFreshWeight,RachisLength,RachisFreshWeight,RachisWC,RachisDryWeight,PetioleLength,PetioleFreshWeight,PetioleWC,PetioleDryWeight,
NumberOfLeaflets,LeafletsFreshWeight,LeafletsWC,LeafletsDryWeight,AverageLeafletSampleLengthBase,AverageLeafletSampleLengthMidd,AverageLeafletSampleLengthTop,AverageLeafletSampleWidthBase,AverageLeafletSampleWidthMidd,AverageLeafletSampleWidthTop,LW_ratio_base,LW_ratio_midd,LW_ratio_top,AverageleafletAreaBase,AverageleafletAreaMidd,AverageleafletAreaTop,AverageSLABase,AverageSLAMidd,AverageSLATop,LeafArea,LAI)
names(obs)
# load CIGE data ----------------------------------------------------------
obs=data.table::fread(file = './Data/Full_Data_Plot_Growth_Bunch_SMSE_B22.txt')%>%
data.frame()%>%
mutate(PlantingDate=PlantingDate,
ObservationDate=ymd(ObservationDate),
MAP=mondf(d2 = ObservationDate,d1 = PlantingDate),
TreeId=as.factor(paste(Site,Plot,BlockNumber,IdGenotype,LineNumber,TreeNumber,sep='_')),
Density=136)
names(obs)
obs
phenoSMSE=read.csv(file ='./0-data/Full_Data_Plot_Pheno_SMSE_B22.txt',header=T,sep='\t')
obs=data.table::fread(file = './Data/Full_Data_Plot_Pheno_SMSE_B22.txt')
View(obs)
# load CIGE data ----------------------------------------------------------
obs=data.table::fread(file = './Data/Full_Data_Plot_Pheno_SMSE_B22.txt')%>%
data.frame()%>%
mutate(PlantingDate=PlantingDate,
HarvestDate=ymd(HarvestDate),
MAP=mondf(d2 = HarvestDate,d1 = PlantingDate),
TreeId=as.factor(paste(Site,Plot,BlockNumber,IdGenotype,LineNumber,TreeNumber,sep='_')),
Density=136)
obs
names(obs)
range(obs$MAP)
range(obs$MAP,na.rm=T)
range(obs$MAP,na.rm=T)/12
range(obs$HarvestDate,na.rm=T)/12
range(obs$HarvestDate,na.rm=T)
range(meteo$Date)
min(meteo$Date)
AGE_INI=PlantingDate-min(meteo$Date)
AGE_INI
AGE_INI=(PlantingDate-min(meteo$Date))/365
AGE_INI
AGE_INI=PlantingDate-min(meteo$Date)
AGE_INI_d=PlantingDate-min(meteo$Date)
AGE_INI_d
AGE_INI_d=min(meteo$Date)-PlantingDate
AGE_INI_d
library(shiny); runApp('App_Xpalm.R')
library(shiny); runApp('App_Xpalm.R')
getwd()
result=data.table::fread(file =paste0('../../bin/msvc14/x64/plant.csv'),header=T,skip = 3)
View(result)
runApp('App_Xpalm.R')
library(shiny); runApp('App_Xpalm.R')
library(shiny); runApp('App_Xpalm.R')
library(shiny); runApp('App_Xpalm.R')
runApp('App_Xpalm.R')
runApp('App_Xpalm.R')
365-(110/9*0.011)
365-(109/9*0.011)
365-(108/9*0.011)
365-(100/9*0.011)
31/3
9*10
1/(9*10)
1/0.011
1/(9*0.011)
365-(108/(9*0.011))
365-108/(9*0.011)
365-10/(9*0.011)
365-1/(9*0.011)
365-2/(9*0.011)
365-3/(9*0.011)
110/(9*0.011)
110/(9*0.011)/365
365-110/(9*0.011)
3*365-110/(9*0.011)
3*365-110/(9*0.011)
3*365-109/(9*0.011)
3*365-108/(9*0.011)
runApp('App_Xpalm.R')
library(shiny); runApp('App_Xpalm.R')
runApp('App_Xpalm.R')
